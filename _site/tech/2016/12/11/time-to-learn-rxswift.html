<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
	<head>
	<meta http-equiv="content-type" content="text/html;charset=utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>YangShanghai's HQ</title>
	<link rel="shortcut icon" href="/image/logo.png">
	<link rel="stylesheet" type="text/css" href="/css/style.css" />
	<link rel="stylesheet" type="text/css" href="/css/syntax.css" />
	<link rel="alternate" type="application/rss+xml" title="RSS" href="http://feeds.feedburner.com/lzyy">
</head>

	<body>
		<div id="nav">
	<div class="wrapper">
		<div id="logo"><a href="/"><img src="/image/logo.png" /></a></h1></div>
		<ul>
			<li id="category-iOS"><a href="/category/iOS.html">iOS</a></li>
			<li id="category-tech"><a href="/category/tech.html">æŠ€æœ¯</a></li>
			<li id="category-essay"><a href="/category/essay.html">éšç¬”</a></li>
			<li id="category-reading"><a href="/category/reading.html">é˜…è¯»</a></li>
			<li id="category-design"><a href="/category/design.html">è®¾è®¡</a></li>
			<li id="category-quotes"><a href="/quotes.html">å¼•è¨€</a></li>
		</ul>
	</div>
</div>

<script>
var category = location.pathname;
if (category == '/') {
	document.getElementById('category-all').style.textDecoration = "underline";
} else if (category == '/category/iOS.html') {
	document.getElementById('category-iOS').style.textDecoration = "underline";
} else if (category == '/category/tech.html') {
	document.getElementById('category-tech').style.textDecoration = "underline";
} else if (category == '/category/design.html') {
	document.getElementById('category-design').style.textDecoration = "underline";
} else if (category == '/category/essay.html') {
	document.getElementById('category-essay').style.textDecoration = "underline";
} else if (category == '/category/reading.html') {
	document.getElementById('category-reading').style.textDecoration = "underline";
} else if (category == '/quotes.html') {
	document.getElementById('category-quotes').style.textDecoration = "underline";
} else if (category == '/category/weekly-recommendation.html') {
	document.getElementById('weekly-recommendation').style.textDecoration = "underline";
}

</script>

		<div class="wrapper main">
			<div id="content">
				<h2>æ˜¯æ—¶å€™å­¦ä¹  RxSwift äº†</h2>
				<div class="cnt">
					<p>ç›¸ä¿¡åœ¨è¿‡å»çš„ä¸€æ®µæ—¶é—´é‡Œï¼Œå¯¹ RxSwift å¤šå°‘æœ‰è¿‡æ¥è§¦æˆ–è€³é—»ï¼Œæˆ–è€…å·²ç»ç§¯ç´¯äº†ä¸å°‘å®æˆ˜ç»éªŒã€‚æ­¤æ–‡ä¸»è¦é’ˆå¯¹é‚£äº›åœ¨é—¨å£å¾˜å¾Šï¼Œæƒ³è¿›åˆæ‹è¸©å‘çš„åŒå­¦ã€‚</p>

<h3 id="ä¸ºä»€ä¹ˆè¦å­¦ä¹ -rxswift">ä¸ºä»€ä¹ˆè¦å­¦ä¹  RxSwift</h3>
<p>å½“å†³å®šåšä¸€ä»¶äº‹æƒ…æ—¶ï¼Œè‡³å°‘è¦çŸ¥é“ä¸ºä»€ä¹ˆã€‚RxSwift å®˜ç½‘ä¸¾äº†<a href="https://github.com/ReactiveX/RxSwift/blob/master/Documentation/Why.md">å‡ ä¸ªä¾‹å­</a>ï¼Œæ¯”å¦‚å¯ä»¥ç»Ÿä¸€å¤„ç† <code class="highlighter-rouge">Delegate</code>, <code class="highlighter-rouge">KVO</code>, <code class="highlighter-rouge">Notification</code>ï¼Œå¯ä»¥ç»‘å®š UIï¼Œæ–¹ä¾¿ç½‘ç»œè¯·æ±‚çš„å¤„ç†ç­‰ç­‰ã€‚ä½†è¿™äº›æ›´å¤šçš„æ˜¯æè¿°å¯ä»¥ç”¨ RxSwift æ¥åšä»€ä¹ˆï¼Œè·Ÿä¸ºä»€ä¹ˆè¦ä½¿ç”¨ RxSwift è¿˜æ˜¯ä¼šæœ‰ç‚¹ä¸åŒã€‚</p>

<p>æˆ‘ä»¬å…ˆæ¥åˆ†æä¸‹ GUI ç¼–ç¨‹çš„æœ¬è´¨ï¼Œæˆ‘å–œæ¬¢æŠŠå®ƒæŠ½è±¡ä¸ºè§†å›¾å’Œæ•°æ®çš„ç»“åˆã€‚å…¶ä¸­è§†å›¾è´Ÿè´£ä¸¤ä»¶äº‹ï¼šå±•ç¤ºå’Œäº¤äº’ï¼Œå±•ç¤ºä»€ä¹ˆç”±æ•°æ®å†³å®šã€‚</p>

<p><img src="/image/14814474678383.jpg" alt="" /></p>

<p>å…¶ä¸­å•å‘æ•°æ®æµå¯ä»¥é€šè¿‡<a href="http://limboy.me/tech/2016/12/04/reswift-analyze.html">ä¹‹å‰ä»‹ç»çš„ ReSwift</a> å®Œæˆã€‚çœ‹èµ·æ¥å¥½åƒæ²¡ RxSwift ä»€ä¹ˆäº‹æƒ…ï¼Œå…¶å®ä¸ç„¶ï¼ŒRxSwift å¯ä»¥åœ¨ UniDirectional Data Flow çš„å„ä¸ªé˜¶æ®µéƒ½å‘æŒ¥ä½œç”¨ï¼Œä»è€Œè®© Data çš„å¤„ç†å’ŒæµåŠ¨æ›´åŠ ç®€æ´å’Œæ¸…æ™°ã€‚</p>

<p><img src="/image/14814474032179.jpg" alt="" /></p>

<ol>
  <li>é€šè¿‡å¯¹ RxCocoa çš„å„ç§å›è°ƒè¿›è¡Œç»Ÿä¸€å¤„ç†ï¼Œæ–¹ä¾¿äº†ã€ŒInteractã€çš„å¤„ç†ã€‚</li>
  <li>é€šè¿‡å¯¹ <code class="highlighter-rouge">Observable</code> çš„ transform å’Œ compositeï¼Œæ–¹ä¾¿äº† <code class="highlighter-rouge">Action</code> çš„ç”Ÿæˆï¼ˆæ¯”å¦‚ä½¿ç”¨ <code class="highlighter-rouge">throttle</code> æ¥å‹ç¼© <code class="highlighter-rouge">Action</code>ï¼‰ã€‚</li>
  <li>é€šè¿‡å¯¹ç½‘ç»œè¯·æ±‚ä»¥åŠå…¶ä»–å¼‚æ­¥æ•°æ®çš„è·å–è¿›è¡Œ <code class="highlighter-rouge">Observable</code> å°è£…ï¼Œæ–¹ä¾¿äº†å¼‚æ­¥æ•°æ®çš„å¤„ç†ã€‚</li>
  <li>é€šè¿‡ RxCocoa çš„ bindingï¼Œæ–¹ä¾¿äº†æ•°æ®çš„æ¸²æŸ“ã€‚</li>
</ol>

<p>æ‰€ä»¥ ReSwift è§„èŒƒäº†æ•°æ®æµï¼ŒRxSwift ä¸ºæ•°æ®çš„å¤„ç†æä¾›äº†æ–¹ä¾¿ï¼Œè¿™ä¸¤ä¸ªç±»åº“çš„ç»“åˆï¼Œå¯ä»¥äº§ç”Ÿæ¸…æ™°çš„æ¶æ„å’Œæ˜“ç»´æŠ¤çš„ä»£ç ã€‚</p>

<p>å½“ç„¶ï¼Œå‰ææ˜¯å¯¹å®ƒä»¬æœ‰è¶³å¤Ÿçš„äº†è§£ï¼Œå°¤å…¶æ˜¯ RxSwiftï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ä»Šå¤©çš„ä¸»è§’ã€‚</p>

<h3 id="ä»€ä¹ˆæ˜¯-rxswift">ä»€ä¹ˆæ˜¯ RxSwift</h3>
<p>åœ¨ GUI ç¼–ç¨‹ä¸­ï¼Œæˆ‘è®¤ä¸ºæ¯”è¾ƒå¤æ‚çš„æœ‰ä¸‰ä¸ªéƒ¨åˆ†ï¼š</p>

<ol>
  <li>éåŸç”Ÿ UI æ•ˆæœçš„å®ç°ï¼ˆæ¯”å¦‚äº§å“ç»ç†ä»¬ç»å¸¸å†’å‡ºæ¥çš„å„ç§æƒ³æ³•ï¼‰ã€‚</li>
  <li>å¤§é‡çŠ¶æ€çš„ç»´æŠ¤ã€‚</li>
  <li>å¼‚æ­¥æ•°æ®çš„å¤„ç†ã€‚</li>
</ol>

<p>1ï¼‰ä¸åœ¨è¿™æ¬¡çš„è®¨è®ºèŒƒç•´ï¼ˆè¿™é‡Œçš„å­¦é—®ä¹Ÿå¾ˆå¤šï¼Œæ¯”å¦‚æµç•…æ€§å’Œæ€§èƒ½ï¼‰ã€‚2) å¯ä»¥é€šè¿‡å•å‘æ•°æ®æµæ¥è§£å†³ï¼ˆç»“åˆ Immutable Dataï¼‰ã€‚3) å¯ä»¥é€šè¿‡ RxSwift æ¥è§£å†³ã€‚é‚£ä¹ˆ RxSwift æ˜¯å¦‚ä½•å¤„ç†å¼‚æ­¥æ•°æ®çš„å‘¢ï¼Ÿ</p>

<p>åœ¨è¯´ RxSwift ä¹‹å‰ï¼Œå…ˆæ¥è¯´ä¸‹ Rxï¼Œ <a href="http://reactivex.io/">ReactiveX</a> æ˜¯ä¸€ç§ç¼–ç¨‹æ¨¡å‹ï¼Œæœ€åˆç”±å¾®è½¯å¼€å‘ï¼Œç»“åˆäº†è§‚å¯Ÿè€…æ¨¡å¼ã€è¿­ä»£å™¨æ¨¡å¼å’Œå‡½æ•°å¼ç¼–ç¨‹çš„ç²¾åï¼Œæ¥æ›´æ–¹ä¾¿åœ°å¤„ç†å¼‚æ­¥æ•°æ®æµã€‚å…¶ä¸­æœ€é‡è¦çš„ä¸€ä¸ªæ¦‚å¿µæ˜¯ <code class="highlighter-rouge">Observable</code>ã€‚</p>

<p>ä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼Œå½“åˆ«äººåœ¨è·Ÿä½ è¯´è¯æ—¶ï¼Œä½ å°±æ˜¯é‚£ä¸ªè§‚å¯Ÿè€…ï¼Œåˆ«äººå°±æ˜¯é‚£ä¸ª <code class="highlighter-rouge">Observable</code>ï¼Œå®ƒæœ‰å‡ ä¸ªç‰¹ç‚¹ï¼š</p>

<ol>
  <li>å¯èƒ½ä¼šä¸æ–­åœ°è·Ÿä½ è¯´è¯ã€‚ï¼ˆ<code class="highlighter-rouge">onNext:</code>ï¼‰</li>
  <li>å¯èƒ½ä¼šè¯´é”™è¯ã€‚ï¼ˆ<code class="highlighter-rouge">onError:</code>ï¼‰</li>
  <li>ç»“æŸä¼šè¯´è¯ã€‚ï¼ˆ<code class="highlighter-rouge">onCompleted</code>ï¼‰</li>
</ol>

<p>ä½ åœ¨å¬åˆ°å¯¹æ–¹è¯´çš„è¯åï¼Œä¹Ÿå¯ä»¥æœ‰å‡ ç§ååº”ï¼š</p>

<ol>
  <li>æ ¹æ®è¯´çš„è¯ï¼Œåšç›¸åº”çš„äº‹ï¼Œæ¯”å¦‚å¯¹æ–¹è®©ä½ å€Ÿæœ¬ä¹¦ç»™ä»–ã€‚ï¼ˆ<code class="highlighter-rouge">subscribe</code>ï¼‰</li>
  <li>æŠŠå¯¹æ–¹è¯´çš„è¯ï¼ŒåŠ å·¥ä¸‹å†ä¼ è¾¾ç»™å…¶ä»–äººï¼Œæ¯”å¦‚å¯¹æ–¹è¯´å°å¼ å¥½åƒä¸å¤ªèˆ’æœï¼Œä½ ä¼ è¾¾ç»™å…¶ä»–äººæ—¶å°±å˜æˆäº†å°å¼ å¤±æ‹äº†ã€‚ï¼ˆ<code class="highlighter-rouge">map:</code>ï¼‰</li>
  <li>å‚è€ƒå…¶ä»–äººè¯´çš„è¯å†åšå¤„ç†ï¼Œæ¯”å¦‚ A è¯´æŸå®¶åº—å¾ˆå¥½åƒï¼ŒB è¯´æŸå®¶åº—ä¸€èˆ¬èˆ¬ï¼Œä½ éœ€è¦ç»“åˆä¸¤ä¸ªäººçš„æ„è§å†åšå®šå¤ºã€‚ï¼ˆ<code class="highlighter-rouge">zip:</code>ï¼‰</li>
</ol>

<p>æ‰€ä»¥ï¼Œä»ç”Ÿæ´»ä¸­ä¹Ÿèƒ½çœ‹åˆ° Rx çš„å½±å­ã€‚ã€Œæœ‰äº›äº‹æƒ…æ€¥ä¸å¾—ï¼Œä½ å¾—ç­‰å®ƒè‡ªå·±ç†Ÿã€ï¼Œå¼‚æ­¥ï¼Œå…¶å®å°±æ˜¯è·Ÿæ—¶é—´æ‰“äº¤é“ï¼Œä¸åŒçš„æ—¶é—´ï¼Œæ‹¿åˆ°çš„æ•°æ®ä¹Ÿä¼šä¸ä¸€æ ·ã€‚å¯ä»¥<a href="http://rxmarbles.com">åœ¨çº¿æ„Ÿå—ä¸‹</a></p>

<p><img src="/image/14814518766811.jpg" alt="" /></p>

<p>è¿™é‡Œçš„æ ¸å¿ƒæ˜¯å½“æ•°æ®æœ‰å˜åŒ–æ—¶ï¼Œèƒ½å¤Ÿç«‹åˆ»çŸ¥æ™“ï¼Œå¹¶ä¸”é€šè¿‡ç»„åˆå’Œè½¬æ¢åï¼Œå¯ä»¥å³æ—¶ä½œå‡ºå“åº”ã€‚æœ‰ç‚¹åƒå¡”é˜²ï¼Œå…ˆåœ¨è·¯ä¸Šçš„å„ä¸ªèŠ‚ç‚¹åŸ‹å¥½æ­¦å™¨ï¼Œç„¶åç­‰ç€å°æ€ªå…½ä»¬è¿‡æ¥ã€‚</p>

<h3 id="rxswift-workflow">RxSwift Workflow</h3>

<p>å¤§è‡´åˆ†ä¸ºè¿™ä¹ˆå‡ ä¸ªé˜¶æ®µï¼šå…ˆæŠŠ Native Object å˜æˆ Observableï¼Œå†é€šè¿‡ Observable å†…ç½®çš„å„ç§å¼ºå¤§çš„è½¬æ¢å’Œç»„åˆèƒ½åŠ›å˜æˆæ–°çš„ Observableï¼Œæœ€åæ¶ˆè´¹æ–°çš„ Observable çš„æ•°æ®ã€‚</p>

<p><img src="/image/14814540314644.jpg" alt="" /></p>

<h4 id="native-object---observable">Native Object -&gt; Observable</h4>

<h5 id="rx-extension">.rx extension</h5>

<p>å‡è®¾éœ€è¦å¤„ç†ç‚¹å‡»äº‹ä»¶ï¼Œæ­£å¸¸çš„åšæ³•æ˜¯ç»™ Tap Gesture æ·»åŠ ä¸€ä¸ª Target-Actionï¼Œç„¶ååœ¨é‚£é‡Œå®ç°å…·ä½“çš„é€»è¾‘ï¼Œè¿™æ ·çš„é—®é¢˜åœ¨äºéœ€è¦é‡æ–°å–åå­—ï¼Œè€Œä¸”ä¸¢å¤±äº†ä¸Šä¸‹æ–‡ã€‚RxSwift (ç¡®åˆ‡è¯´æ˜¯ RxCocoa) ç»™ç³»ç»Ÿçš„è¯¸å¤šåŸç”Ÿæ§ä»¶ï¼ˆåŒ…æ‹¬åƒ <code class="highlighter-rouge">URLSession</code>ï¼‰æä¾›äº† rx æ‰©å±•ï¼Œæ‰€ä»¥ç‚¹å‡»çš„å¤„ç†å°±å˜æˆäº†è¿™æ ·ï¼š</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9</pre></td><td class="code"><pre><span class="k">let</span> <span class="nv">tapBackground</span> <span class="o">=</span> <span class="kt">UITapGestureRecognizer</span><span class="p">()</span>

<span class="n">tapBackground</span><span class="o">.</span><span class="n">rx</span><span class="o">.</span><span class="n">event</span>
    <span class="o">.</span><span class="nf">subscribe</span><span class="p">(</span><span class="nv">onNext</span><span class="p">:</span> <span class="p">{</span> <span class="p">[</span><span class="k">weak</span> <span class="k">self</span><span class="p">]</span> <span class="n">_</span> <span class="k">in</span>
        <span class="k">self</span><span class="p">?</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="nf">endEditing</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
    <span class="p">})</span>
    <span class="o">.</span><span class="nf">addDisposableTo</span><span class="p">(</span><span class="n">disposeBag</span><span class="p">)</span>
    
<span class="n">view</span><span class="o">.</span><span class="nf">addGestureRecognizer</span><span class="p">(</span><span class="n">tapBackground</span><span class="p">)</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p>æ˜¯ä¸æ˜¯ç®€æ´äº†å¾ˆå¤šã€‚</p>

<h5 id="observablecreate">Observable.create</h5>

<p>é€šè¿‡è¿™ä¸ªæ–¹æ³•ï¼Œå¯ä»¥å°† Native çš„ object åŒ…è£…æˆ <code class="highlighter-rouge">Observable</code>ï¼Œæ¯”å¦‚å¯¹ç½‘ç»œè¯·æ±‚çš„å°è£…ï¼š</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14</pre></td><td class="code"><pre><span class="kd">public</span> <span class="kd">func</span> <span class="nf">response</span><span class="p">(</span><span class="n">_</span> <span class="nv">request</span><span class="p">:</span> <span class="kt">URLRequest</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Observable</span><span class="o">&lt;</span><span class="p">(</span><span class="kt">Data</span><span class="p">,</span> <span class="kt">HTTPURLResponse</span><span class="p">)</span><span class="o">&gt;</span> <span class="p">{</span>
	<span class="k">return</span> <span class="kt">Observable</span><span class="o">.</span><span class="n">create</span> <span class="p">{</span> <span class="n">observer</span> <span class="k">in</span>
		<span class="k">let</span> <span class="nv">task</span> <span class="o">=</span> <span class="k">self</span><span class="o">.</span><span class="nf">dataTaskWithRequest</span><span class="p">(</span><span class="n">request</span><span class="p">)</span> <span class="p">{</span> <span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">response</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span> <span class="k">in</span>
			<span class="n">observer</span><span class="o">.</span><span class="nf">on</span><span class="p">(</span><span class="o">.</span><span class="nf">next</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">httpResponse</span><span class="p">))</span>
			<span class="n">observer</span><span class="o">.</span><span class="nf">on</span><span class="p">(</span><span class="o">.</span><span class="n">completed</span><span class="p">)</span>
		<span class="p">}</span>

		<span class="n">task</span><span class="o">.</span><span class="nf">resume</span><span class="p">()</span>

		<span class="k">return</span> <span class="kt">Disposables</span><span class="o">.</span><span class="n">create</span> <span class="p">{</span>
			<span class="n">task</span><span class="o">.</span><span class="nf">cancel</span><span class="p">()</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p>å‡ºäºä»£ç çš„ç®€æ´ï¼Œç•¥å»äº†å¯¹ error çš„å¤„ç†ï¼Œä½¿ç”¨å§¿åŠ¿ç±»ä¼¼</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7</pre></td><td class="code"><pre><span class="k">let</span> <span class="nv">disposeBag</span> <span class="o">=</span> <span class="kt">DisposeBag</span><span class="p">()</span>

<span class="nf">response</span><span class="p">(</span><span class="n">aRequest</span><span class="p">)</span>
  <span class="o">.</span><span class="nf">subscribe</span><span class="p">(</span><span class="nv">onNext</span><span class="p">:</span> <span class="p">{</span> <span class="n">data</span> <span class="k">in</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
  <span class="p">})</span>
  <span class="o">.</span><span class="nf">addDisposableTo</span><span class="p">(</span><span class="n">disposeBag</span><span class="p">)</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p>è¿™é‡Œæœ‰ä¸¤ä¸ªæ³¨æ„ç‚¹ï¼š</p>

<ol>
  <li><code class="highlighter-rouge">Observerable</code> è¿”å›çš„æ˜¯ä¸€ä¸ª <code class="highlighter-rouge">Disposable</code>ï¼Œè¡¨ç¤ºã€Œå¯æ‰”æ‰ã€çš„ï¼Œæ‰”å“ªé‡Œå‘¢ï¼Œå°±æ‰”åˆ°åˆšåˆšåˆ›å»ºçš„è¢‹å­é‡Œï¼Œè¿™æ ·å½“è¢‹å­è¢«å›æ”¶ï¼ˆ<code class="highlighter-rouge">dealloc</code>ï¼‰æ—¶ï¼Œä¼šé¡ºä¾¿æ‰§è¡Œä¸€ä¸‹ <code class="highlighter-rouge">Disposable.dispose()</code>ï¼Œä¹‹å‰åˆ›å»º <code class="highlighter-rouge">Disposable</code> æ—¶ç”³è¯·çš„èµ„æºå°±ä¼šè¢«ä¸€å¹¶é‡Šæ”¾æ‰ã€‚</li>
  <li>å¦‚æœæœ‰å¤šä¸ª subscriber æ¥ subscribe <code class="highlighter-rouge">response(aRequest)</code> é‚£ä¹ˆä¼šåˆ›å»ºå¤šä¸ªè¯·æ±‚ï¼Œä»ä»£ç ä¹Ÿå¯ä»¥çœ‹å¾—å‡ºæ¥ï¼Œæ¥ä¸€ä¸ª observer å°±åˆ›å»ºä¸€ä¸ª taskï¼Œç„¶åæ‰§è¡Œã€‚è¿™å¾ˆæœ‰å¯èƒ½ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ï¼Œå¦‚ä½•è®©å¤šä¸ª subscriber å…±äº«ä¸€ä¸ªç»“æœï¼Œè¿™ä¸ªåé¢ä¼šæåˆ°ã€‚</li>
</ol>

<h5 id="variable">Variable()</h5>

<p><code class="highlighter-rouge">Variable(value)</code> å¯ä»¥æŠŠ value å˜æˆä¸€ä¸ª <code class="highlighter-rouge">Observable</code>ï¼Œä¸è¿‡å‰ææ˜¯ä½¿ç”¨æ–°çš„èµ‹å€¼æ–¹å¼ <code class="highlighter-rouge">aVariable.value = newValue</code>ï¼Œæ¥çœ‹ä¸ª Demo</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13</pre></td><td class="code"><pre><span class="k">let</span> <span class="nv">magicNumber</span> <span class="o">=</span> <span class="mi">42</span>

<span class="k">let</span> <span class="nv">magicNumberVariable</span> <span class="o">=</span> <span class="kt">Variable</span><span class="p">(</span><span class="n">magicNumber</span><span class="p">)</span>
<span class="n">magicNumberVariable</span><span class="o">.</span><span class="nf">asObservable</span><span class="p">()</span><span class="o">.</span><span class="nf">subscribe</span><span class="p">(</span><span class="nv">onNext</span><span class="p">:</span> <span class="p">{</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">"magic number is </span><span class="se">\(</span><span class="nv">$0</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
<span class="p">})</span>

<span class="n">magicNumberVariable</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">73</span>

<span class="c1">// output</span>
<span class="c1">// </span>
<span class="c1">// magic number is 42</span>
<span class="c1">// magic number is 73</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p>èµ·åˆçœ‹åˆ°æ—¶ï¼Œè§‰å¾—è¿˜è›®ç¥å¥‡çš„ï¼Œè·Ÿè¿›å»çœ‹äº†ä¸‹ï¼Œå‘ç°æ˜¯é€šè¿‡ <code class="highlighter-rouge">subject</code> æ¥åšçš„ï¼Œå¤§æ„æ˜¯æŠŠ <code class="highlighter-rouge">value</code> å­˜åˆ°ä¸€ä¸ªå†…éƒ¨å˜é‡ <code class="highlighter-rouge">_value</code> é‡Œï¼Œå½“è°ƒç”¨ <code class="highlighter-rouge">value</code> æ–¹æ³•æ—¶ï¼Œå…ˆæ›´æ–° <code class="highlighter-rouge">_value</code> å€¼ï¼Œç„¶åè°ƒç”¨å†…éƒ¨çš„ <code class="highlighter-rouge">_subject.on(.next(newValue))</code> æ–¹æ³•å‘ŠçŸ¥ subscriberã€‚</p>

<h5 id="subject">Subject</h5>

<p><code class="highlighter-rouge">Subject</code> ç®€å•æ¥è¯´æ˜¯ä¸€ä¸ªå¯ä»¥ä¸»åŠ¨å‘å°„æ•°æ®çš„ <code class="highlighter-rouge">Observable</code>ï¼Œå¤šäº† <code class="highlighter-rouge">onNext(value)</code>, <code class="highlighter-rouge">onError(error)</code>, â€˜onCompletedâ€™ æ–¹æ³•ï¼Œå¯è°“å…¨èƒ½å‹é€‰æ‰‹ã€‚</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10</pre></td><td class="code"><pre><span class="k">let</span> <span class="nv">disposeBag</span> <span class="o">=</span> <span class="kt">DisposeBag</span><span class="p">()</span>
<span class="k">let</span> <span class="nv">subject</span> <span class="o">=</span> <span class="kt">PublishSubject</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span><span class="p">()</span>
    
<span class="n">subject</span><span class="o">.</span><span class="nf">addObserver</span><span class="p">(</span><span class="s">"1"</span><span class="p">)</span><span class="o">.</span><span class="nf">addDisposableTo</span><span class="p">(</span><span class="n">disposeBag</span><span class="p">)</span>
<span class="n">subject</span><span class="o">.</span><span class="nf">onNext</span><span class="p">(</span><span class="s">"ğŸ¶"</span><span class="p">)</span>
<span class="n">subject</span><span class="o">.</span><span class="nf">onNext</span><span class="p">(</span><span class="s">"ğŸ±"</span><span class="p">)</span>
    
<span class="n">subject</span><span class="o">.</span><span class="nf">addObserver</span><span class="p">(</span><span class="s">"2"</span><span class="p">)</span><span class="o">.</span><span class="nf">addDisposableTo</span><span class="p">(</span><span class="n">disposeBag</span><span class="p">)</span>
<span class="n">subject</span><span class="o">.</span><span class="nf">onNext</span><span class="p">(</span><span class="s">"ğŸ…°ï¸"</span><span class="p">)</span>
<span class="n">subject</span><span class="o">.</span><span class="nf">onNext</span><span class="p">(</span><span class="s">"ğŸ…±ï¸"</span><span class="p">)</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p>è®°å¾—åœ¨ RAC æ—¶ä»£ï¼Œsubject æ˜¯ä¸€ä¸ªä¸å¤ªæ¨èä½¿ç”¨çš„åŠŸèƒ½ï¼Œå› ä¸ºè¿‡äºå¼ºå¤§äº†ï¼Œå®¹æ˜“å¤±æ§ã€‚RxSwift é‡Œå€’æ˜¯æ²¡æœ‰å¤ªæåŠï¼Œä½†è¿˜æ˜¯å°‘ç”¨ä¸ºä½³ã€‚</p>

<h4 id="observable---new-observable">Observable -&gt; New Observable</h4>
<p><code class="highlighter-rouge">Observable</code> çš„å¼ºå¤§ä¸ä»…åœ¨äºå®ƒèƒ½å®æ—¶æ›´æ–° valueï¼Œè¿˜åœ¨äºå®ƒèƒ½è¢«ä¿®æ”¹ï¼è¿‡æ»¤ï¼ç»„åˆç­‰ï¼Œè¿™æ ·å°±èƒ½éšå¿ƒæ‰€æ¬²åœ°æ„é€ è‡ªå·±æƒ³è¦çš„æ•°æ®ï¼Œè¿˜ä¸ç”¨æ‹…å¿ƒæ•°æ®å‘ç”Ÿå˜åŒ–äº†å´ä¸çŸ¥é“çš„æƒ…å†µã€‚</p>

<h5 id="combine">Combine</h5>
<p>Combine å°±æ˜¯æŠŠå¤šä¸ª <code class="highlighter-rouge">Observable</code> ç»„åˆèµ·æ¥ä½¿ç”¨ï¼Œæ¯”å¦‚ <code class="highlighter-rouge">zip</code> (å°æç¤ºï¼šå¦‚æœå¯¹è¿™äº›å‡½æ•°ä¸å¤ªæ•æ„Ÿï¼Œå¯ä»¥<a href="http://rxmarbles.com/">å®é™…æ“ä½œä¸‹</a>ï¼Œä½“ä¼šä¼šæ›´æ·±äº›)</p>

<p><code class="highlighter-rouge">zip</code> å¯¹åº”ç°å®ä¸­çš„ä¾‹å­å°±æ˜¯æ‹‰é“¾ï¼Œæ‹‰é“¾éœ€è¦ä¸¤ä¸ªå…ƒç´ è¿™æ ·æ‰èƒ½æ‹‰ä¸Šå»ï¼Œè¿™é‡Œä¹Ÿä¸€æ ·ï¼Œåªæœ‰å½“ä¸¤ä¸ª <code class="highlighter-rouge">Observable</code> éƒ½æœ‰äº†æ–°çš„å€¼æ—¶ï¼Œsubscribe æ‰ä¼šè¢«è§¦å‘ã€‚</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19</pre></td><td class="code"><pre><span class="k">let</span> <span class="nv">stringSubject</span> <span class="o">=</span> <span class="kt">PublishSubject</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span><span class="p">()</span>
<span class="k">let</span> <span class="nv">intSubject</span> <span class="o">=</span> <span class="kt">PublishSubject</span><span class="o">&lt;</span><span class="kt">Int</span><span class="o">&gt;</span><span class="p">()</span>

<span class="kt">Observable</span><span class="o">.</span><span class="nf">zip</span><span class="p">(</span><span class="n">stringSubject</span><span class="p">,</span> <span class="n">intSubject</span><span class="p">)</span> <span class="p">{</span> <span class="n">stringElement</span><span class="p">,</span> <span class="n">intElement</span> <span class="k">in</span>
	<span class="s">"</span><span class="se">\(</span><span class="n">stringElement</span><span class="se">)</span><span class="s"> </span><span class="se">\(</span><span class="n">intElement</span><span class="se">)</span><span class="s">"</span>
	<span class="p">}</span>
	<span class="o">.</span><span class="nf">subscribe</span><span class="p">(</span><span class="nv">onNext</span><span class="p">:</span> <span class="p">{</span> <span class="nf">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">})</span>
	<span class="o">.</span><span class="nf">addDisposableTo</span><span class="p">(</span><span class="n">disposeBag</span><span class="p">)</span>

<span class="n">stringSubject</span><span class="o">.</span><span class="nf">onNext</span><span class="p">(</span><span class="s">"ğŸ…°ï¸"</span><span class="p">)</span>
<span class="n">stringSubject</span><span class="o">.</span><span class="nf">onNext</span><span class="p">(</span><span class="s">"ğŸ…±ï¸"</span><span class="p">)</span>

<span class="n">intSubject</span><span class="o">.</span><span class="nf">onNext</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">intSubject</span><span class="o">.</span><span class="nf">onNext</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

<span class="c1">// output</span>
<span class="c1">//</span>
<span class="c1">// ğŸ…°ï¸ 1</span>
<span class="c1">// ğŸ…±ï¸ 2</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p>å¦‚æœè¿™é‡Œ <code class="highlighter-rouge">intSubject</code> å§‹ç»ˆæ²¡æœ‰æ‰§è¡Œ <code class="highlighter-rouge">onNext</code>ï¼Œé‚£ä¹ˆå°†ä¸ä¼šæœ‰è¾“å‡ºï¼Œå°±åƒæ‹‰é“¾æ‰äº†ä¸€è¾¹çš„é“¾å­å°±æ‹‰ä¸ä¸Šäº†ã€‚</p>

<p>é™¤äº† <code class="highlighter-rouge">zip</code>ï¼Œè¿˜æœ‰å…¶ä»–çš„ combine çš„å§¿åŠ¿ï¼Œæ¯”å¦‚ <code class="highlighter-rouge">combineLatest</code> / <code class="highlighter-rouge">switchLatest</code> ç­‰ã€‚</p>

<h5 id="transform">Transform</h5>
<p>è¿™æ˜¯æœ€å¸¸è§çš„æ“ä½œäº†ï¼Œå¯¹ä¸€ä¸ª <code class="highlighter-rouge">Observable</code> çš„æ•°å€¼åšä¸€äº›å°æ”¹åŠ¨ï¼Œç„¶åäº§å‡ºæ–°çš„å€¼ï¼Œä¾æ—§æ˜¯ä¸€ä¸ª <code class="highlighter-rouge">Observable</code>ã€‚</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5</pre></td><td class="code"><pre><span class="k">let</span> <span class="nv">disposeBag</span> <span class="o">=</span> <span class="kt">DisposeBag</span><span class="p">()</span>
<span class="kt">Observable</span><span class="o">.</span><span class="nf">of</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="nv">$0</span> <span class="o">*</span> <span class="nv">$0</span> <span class="p">}</span>
    <span class="o">.</span><span class="nf">subscribe</span><span class="p">(</span><span class="nv">onNext</span><span class="p">:</span> <span class="p">{</span> <span class="nf">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">})</span>
    <span class="o">.</span><span class="nf">addDisposableTo</span><span class="p">(</span><span class="n">disposeBag</span><span class="p">)</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p>è¿™æ˜¯å¤§è‡´çš„å®ç°ï¼ˆæ‘˜è‡ªå®˜ç½‘ï¼‰</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19</pre></td><td class="code"><pre><span class="kd">extension</span> <span class="kt">ObservableType</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="n">myMap</span><span class="o">&lt;</span><span class="kt">R</span><span class="o">&gt;</span><span class="p">(</span><span class="nv">transform</span><span class="p">:</span> <span class="kt">E</span> <span class="o">-&gt;</span> <span class="kt">R</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Observable</span><span class="o">&lt;</span><span class="kt">R</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kt">Observable</span><span class="o">.</span><span class="n">create</span> <span class="p">{</span> <span class="n">observer</span> <span class="k">in</span>
            <span class="k">let</span> <span class="nv">subscription</span> <span class="o">=</span> <span class="k">self</span><span class="o">.</span><span class="n">subscribe</span> <span class="p">{</span> <span class="n">e</span> <span class="k">in</span>
                    <span class="k">switch</span> <span class="n">e</span> <span class="p">{</span>
                    <span class="k">case</span> <span class="o">.</span><span class="nf">next</span><span class="p">(</span><span class="k">let</span> <span class="nv">value</span><span class="p">):</span>
                        <span class="k">let</span> <span class="nv">result</span> <span class="o">=</span> <span class="nf">transform</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                        <span class="n">observer</span><span class="o">.</span><span class="nf">on</span><span class="p">(</span><span class="o">.</span><span class="nf">next</span><span class="p">(</span><span class="n">result</span><span class="p">))</span>
                    <span class="k">case</span> <span class="o">.</span><span class="nf">error</span><span class="p">(</span><span class="k">let</span> <span class="nv">error</span><span class="p">):</span>
                        <span class="n">observer</span><span class="o">.</span><span class="nf">on</span><span class="p">(</span><span class="o">.</span><span class="nf">error</span><span class="p">(</span><span class="n">error</span><span class="p">))</span>
                    <span class="k">case</span> <span class="o">.</span><span class="nv">completed</span><span class="p">:</span>
                        <span class="n">observer</span><span class="o">.</span><span class="nf">on</span><span class="p">(</span><span class="o">.</span><span class="n">completed</span><span class="p">)</span>
                    <span class="p">}</span>
                <span class="p">}</span>

            <span class="k">return</span> <span class="n">subscription</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p>æ¥å—ä¸€ä¸ª transform é—­åŒ…ï¼Œç„¶åè¿”å›ä¸€ä¸ª <code class="highlighter-rouge">Observable</code>ï¼Œå› ä¸ºæ¥ä¸‹æ¥ä½¿ç”¨è€…å°†ä¼šå¯¹ <code class="highlighter-rouge">myMap</code> çš„ç»“æœè¿›è¡Œ subscribeï¼Œæ‰€ä»¥éœ€è¦åœ¨ create å†…éƒ¨ subscribe ä¸€ä¸‹ï¼Œä¸ç„¶æœ€å¼€å§‹çš„é‚£ä¸ª <code class="highlighter-rouge">Observable</code> å°±æ˜¯ä¸ª <code class="highlighter-rouge">Cold Observable</code>ï¼Œä¸€ä¸ª <code class="highlighter-rouge">Cold Observable</code> æ˜¯ä¸ä¼šäº§ç”Ÿæ–°çš„æ•°æ®çš„ã€‚</p>

<h5 id="filter">Filter</h5>
<p>Filter çš„ä½œç”¨æ˜¯å¯¹ <code class="highlighter-rouge">Observable</code> ä¼ è¿‡æ¥çš„æ•°æ®è¿›è¡Œè¿‡æ»¤ï¼Œåªæœ‰ç¬¦åˆæ¡ä»¶çš„æ‰æœ‰èµ„æ ¼è¢« subscribeã€‚å†™æ³•ä¸Šè·Ÿ map å·®ä¸å¤šï¼Œå°±ä¸èµ˜è¿°äº†ã€‚</p>

<h5 id="connect">Connect</h5>
<p>è¿™æ˜¯æŒºæœ‰æ„æ€çš„ä¸€å—ï¼Œåœ¨ä¹‹å‰ä»‹ç» <code class="highlighter-rouge">Observable.create</code> æ—¶æœ‰æåˆ°è¿‡ï¼Œä¸€ä¸ª <code class="highlighter-rouge">Observable</code> è¢«å¤šæ¬¡ subscribe å°±ä¼šè¢«å¤šæ¬¡è§¦å‘ï¼Œå¦‚æœä¸€ä¸ªç½‘ç»œè¯·æ±‚åªæƒ³è¢«è§¦å‘ä¸€æ¬¡ï¼ŒåŒæ—¶æ”¯æŒå¤šä¸ª subscriberï¼Œå°±å¯ä»¥ä½¿ç”¨ <code class="highlighter-rouge">publish</code> + <code class="highlighter-rouge">connect</code> çš„ç»„åˆã€‚</p>

<p>å½“ä¸€ä¸ª <code class="highlighter-rouge">Observable</code> ä½¿ç”¨äº† <code class="highlighter-rouge">publish()</code> æ–¹æ³•åï¼Œæ­£å¸¸çš„ subscribe å°±ä¸ä¼šè§¦å‘å®ƒäº†ï¼Œé™¤é <code class="highlighter-rouge">connect()</code> æ–¹æ³•è¢«è°ƒç”¨ã€‚è€Œä¸”æ¯æ¬¡ subscribe ä¸ä¼šå¯¼è‡´ <code class="highlighter-rouge">Observable</code> é‡æ–°é’ˆå¯¹ observer å¤„ç†ä¸€éã€‚çœ‹ä¸€ä¸‹è¿™å¼ å›¾</p>

<p><img src="http://reactivex.io/documentation/operators/images/publishConnect.c.png" alt="" /></p>

<p>æœ‰ä¸¤å—éœ€è¦æ³¨æ„ï¼š</p>

<ol>
  <li><code class="highlighter-rouge">connect()</code> ä¹‹å‰çš„ä¸¤æ¬¡ <code class="highlighter-rouge">subscribe</code> å¹¶æ²¡æœ‰äº§ç”Ÿæ–°çš„ valueã€‚</li>
  <li><code class="highlighter-rouge">connect()</code> ä¹‹å <code class="highlighter-rouge">subscribe</code> çš„ï¼Œåªæ˜¯ç­‰å¾…æ–°çš„ valueï¼ŒåŒæ—¶æ–°çš„ value è¿˜ä¼šåˆ†å‘ç»™ä¹‹å‰çš„ subscriberã€‚</li>
  <li>å³ä½¿æ‰€æœ‰çš„ <code class="highlighter-rouge">subscription</code> è¢« <code class="highlighter-rouge">dispose</code>, <code class="highlighter-rouge">Observable</code> ä¾æ—§å¤„äº <code class="highlighter-rouge">hot</code> çŠ¶æ€ï¼Œå°±å¥½åƒè¿˜ä»¥ä¸ºæœ‰äººå…³å¿ƒæ–°çš„å€¼ä¸€æ ·ã€‚ï¼ˆè¿™å¯èƒ½ä¸æ˜¯æƒ³è¦çš„ç»“æœï¼‰</li>
</ol>

<p>é’ˆå¯¹ç¬¬ 3 ç‚¹ï¼Œå¯ä»¥ä½¿ç”¨ <code class="highlighter-rouge">refcount()</code> æ¥ä»£æ›¿ <code class="highlighter-rouge">connect()</code>ï¼Œå‰è€…ä¼šåœ¨æ²¡æœ‰ subscriber æ—¶è‡ªåŠ¨ã€Œå†·ã€ä¸‹æ¥ï¼Œä¸ä¼šå†äº§ç”Ÿæ–°çš„å€¼ã€‚ï¼ˆDemo å–è‡ª<a href="http://www.tailec.com/blog/understanding-publish-connect-refcount-share">è¿™é‡Œ</a>ï¼‰</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17</pre></td><td class="code"><pre><span class="k">let</span> <span class="nv">myObservable</span> <span class="o">=</span> <span class="kt">Observable</span><span class="o">&lt;</span><span class="kt">Int</span><span class="o">&gt;.</span><span class="nf">interval</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nv">scheduler</span><span class="p">:</span> <span class="kt">MainScheduler</span><span class="o">.</span><span class="n">instance</span><span class="p">)</span><span class="o">.</span><span class="nf">publish</span><span class="p">()</span><span class="o">.</span><span class="nf">refCount</span><span class="p">()</span> <span class="c1">// 1)</span>

<span class="k">let</span> <span class="nv">mySubscription</span> <span class="o">=</span> <span class="n">myObservable</span><span class="o">.</span><span class="nf">subscribe</span><span class="p">(</span><span class="nv">onNext</span><span class="p">:</span> <span class="p">{</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">"Next: </span><span class="se">\(</span><span class="nv">$0</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
<span class="p">})</span>

<span class="nf">delay</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">"Disposing at 3 seconds"</span><span class="p">)</span>
    <span class="n">mySubscription</span><span class="o">.</span><span class="nf">dispose</span><span class="p">()</span>
<span class="p">}</span>

<span class="nf">delay</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> <span class="p">{</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">"Subscribing again at 6 seconds"</span><span class="p">)</span>
    <span class="n">myObservable</span><span class="o">.</span><span class="nf">subscribe</span><span class="p">(</span><span class="nv">onNext</span><span class="p">:</span> <span class="p">{</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"Next: </span><span class="se">\(</span><span class="nv">$0</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
    <span class="p">})</span>
<span class="p">}</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p>è¾“å‡º</p>

<div class="highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8</pre></td><td class="code"><pre>Starting at 0 seconds
Next: 0
Next: 1
Next: 2
Disposing at 3 seconds
Subscribing again at 6 seconds
Next: 0
Next: 1
</pre></td></tr></tbody></table>
</div>
</div>

<p>å¯ä»¥çœ‹åˆ°ï¼Œ3 ç§’å subscription disposeï¼Œæ­¤æ—¶æ²¡æœ‰ä»»ä½• subscriber è¿˜å…³å¿ƒ <code class="highlighter-rouge">Observable</code>ï¼Œå› æ­¤å°±é‡ç½®äº†ï¼Œæ‰€ä»¥ 6 ç§’ååˆå›åˆ°äº†åˆå§‹çŠ¶æ€ï¼ˆå¦‚æœå˜æˆ <code class="highlighter-rouge">connect</code> æ–¹æ³•çš„è¯ï¼Œä¼šå‘ç° 6 ç§’åä¼šè¾“å‡º <code class="highlighter-rouge">Next: 6 / Next: 7</code>ï¼‰</p>

<p>é‚£å¦‚æœååŠ å…¥çš„ subscriber æƒ³è¦ä¹‹å‰çš„æ•°æ®æ€ä¹ˆåŠï¼Ÿå¯ä»¥å¯¹åŸå§‹çš„ <code class="highlighter-rouge">Observable</code> è®¾ç½® <code class="highlighter-rouge">replay(n)</code>ï¼Œè¡¨ç¤ºæœ€å¤šè¿”å› n ä¸ªå…ƒç´ ç»™ååŠ å…¥çš„ subscriberã€‚</p>

<h3 id="tips">Tips</h3>
<p>ä¸Šé¢ä»‹ç»çš„æ˜¯æœ€åŸºæœ¬çš„æ¦‚å¿µã€‚é¡ºä¾¿æä¸€ä¸‹æ¯”è¾ƒå¸¸è§çš„å‡ ä¸ªé—®é¢˜ï¼š</p>

<h4 id="å¦‚ä½•å¤„ç†-scheduler">å¦‚ä½•å¤„ç† Schedulerï¼Ÿ</h4>

<p>é»˜è®¤ä»£ç éƒ½æ˜¯åœ¨å½“å‰çº¿ç¨‹ä¸­æ‰§è¡Œçš„ï¼Œå¦‚æœè¦æ‰‹åŠ¨åˆ‡æ¢çº¿ç¨‹ï¼Œå¯ä»¥ä½¿ç”¨ <code class="highlighter-rouge">subsribeOn</code> å’Œ <code class="highlighter-rouge">observeOn</code> ä¸¤ç§æ–¹å¼ï¼Œä¸€èˆ¬æ¥è¯´åè€…ç”¨å¾—ä¼šå¤šä¸€äº›ï¼Œé‚£è¿™ä¸¤è€…æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ</p>

<p><code class="highlighter-rouge">subscribeOn</code> è·Ÿä½ç½®æ— å…³ï¼Œä¹Ÿå°±æ˜¯æ— è®ºåœ¨é“¾å¼è°ƒç”¨çš„ä»€ä¹ˆåœ°æ–¹ï¼Œ<code class="highlighter-rouge">Observable</code> å’Œ <code class="highlighter-rouge">subscription</code> éƒ½ä¼šå—å½±å“ï¼›è€Œ <code class="highlighter-rouge">observeOn</code> åˆ™ä»…å¯¹ä¹‹åçš„è°ƒç”¨äº§ç”Ÿå½±å“ï¼Œçœ‹ä¸ª Demoï¼š</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</pre></td><td class="code"><pre><span class="k">var</span> <span class="nv">observable</span> <span class="o">=</span> <span class="kt">Observable</span><span class="o">&lt;</span><span class="kt">Int</span><span class="o">&gt;.</span><span class="n">create</span> <span class="p">{</span> <span class="p">(</span><span class="nv">observer</span><span class="p">:</span> <span class="kt">AnyObserver</span><span class="o">&lt;</span><span class="kt">Int</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Disposable</span> <span class="k">in</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">"observable thread: </span><span class="se">\(</span><span class="kt">Thread</span><span class="o">.</span><span class="n">current</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
    <span class="n">observer</span><span class="o">.</span><span class="nf">onNext</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">observer</span><span class="o">.</span><span class="nf">onCompleted</span><span class="p">()</span>
    <span class="k">return</span> <span class="kt">Disposables</span><span class="o">.</span><span class="nf">create</span><span class="p">()</span>
<span class="p">}</span>

<span class="k">let</span> <span class="nv">disposeBag</span> <span class="o">=</span> <span class="kt">DisposeBag</span><span class="p">()</span>

<span class="n">observable</span>
    <span class="o">.</span><span class="nf">map</span><span class="p">({</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Int</span> <span class="k">in</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"map1 thread: </span><span class="se">\(</span><span class="kt">Thread</span><span class="o">.</span><span class="n">current</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">e</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="p">})</span>
    <span class="o">.</span><span class="nf">observeOn</span><span class="p">(</span><span class="kt">ConcurrentDispatchQueueScheduler</span><span class="p">(</span><span class="nv">qos</span><span class="p">:</span> <span class="o">.</span><span class="n">userInteractive</span><span class="p">))</span> <span class="c1">// 1</span>
    <span class="o">.</span><span class="nf">map</span><span class="p">({</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Int</span> <span class="k">in</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"map2 thread: </span><span class="se">\(</span><span class="kt">Thread</span><span class="o">.</span><span class="n">current</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">e</span> <span class="o">+</span> <span class="mi">2</span>
    <span class="p">})</span>
    <span class="o">.</span><span class="nf">subscribe</span><span class="p">(</span><span class="nv">onNext</span><span class="p">:{</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Void</span> <span class="k">in</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"subscribe thread: </span><span class="se">\(</span><span class="kt">Thread</span><span class="o">.</span><span class="n">current</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
    <span class="p">})</span>
    <span class="o">.</span><span class="nf">addDisposableTo</span><span class="p">(</span><span class="n">disposeBag</span><span class="p">)</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p>å¦‚æœ 1) æ˜¯ <code class="highlighter-rouge">observeOn</code>ï¼Œé‚£ä¹ˆè¾“å‡ºå¦‚ä¸‹</p>

<div class="highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4</pre></td><td class="code"><pre>observable thread: &lt;NSThread: 0x7f901cc0d510&gt;{number = 1, name = main}
map1 thread: &lt;NSThread: 0x7f901cc0d510&gt;{number = 1, name = main}
map2 thread: &lt;NSThread: 0x7f901ce15560&gt;{number = 3, name = (null)}
subscribe thread: &lt;NSThread: 0x7f901ce15560&gt;{number = 3, name = (null)}
</pre></td></tr></tbody></table>
</div>
</div>

<p>å¯ä»¥çœ‹åˆ° observable thread å’Œ map1 thread ä¾æ—§ä¿æŒå½“å‰çº¿ç¨‹ï¼Œä½† <code class="highlighter-rouge">observeOn</code> ä¹‹åå°±å˜æˆäº†å¦ä¸€ä¸ªçº¿ç¨‹ã€‚</p>

<p>å¦‚æœ 1) æ˜¯ <code class="highlighter-rouge">subscribeOn</code>ï¼Œé‚£ä¹ˆä¼šè¾“å‡º</p>

<div class="highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4</pre></td><td class="code"><pre>observable thread: &lt;NSThread: 0x7fbdf1e097a0&gt;{number = 3, name = (null)}
map1 thread: &lt;NSThread: 0x7fbdf1e097a0&gt;{number = 3, name = (null)}
map2 thread: &lt;NSThread: 0x7fbdf1e097a0&gt;{number = 3, name = (null)}
subscribe thread: &lt;NSThread: 0x7fbdf1e097a0&gt;{number = 3, name = (null)}
</pre></td></tr></tbody></table>
</div>
</div>

<p>å¯ä»¥çœ‹åˆ°å…¨éƒ½å˜æˆäº† <code class="highlighter-rouge">subscribeOn</code> æŒ‡å®šçš„ Queueã€‚æ‰€ä»¥ <code class="highlighter-rouge">subscribeOn</code> çš„æ„ŸæŸ“åŠ›å¾ˆå¼ºï¼Œè¿ <code class="highlighter-rouge">Observable</code> éƒ½èƒ½å½±å“åˆ°ã€‚</p>

<h4 id="cold-observable-å’Œ-hot-observable">Cold Observable å’Œ Hot Observable</h4>

<p>Cold ç›¸å½“äº InActiveï¼Œå°±åƒè¥¿éƒ¨ä¸–ç•Œé‡Œï¼Œæœªè¢«æ¿€æ´»çš„æœºå™¨äººä¸€æ ·ï¼›Hot å°±æ˜¯å¤„äºå·¥ä½œçŠ¶æ€çš„æœºå™¨äººã€‚</p>

<h4 id="subscription-ä¸ºä»€ä¹ˆè¦-dispose">Subscription ä¸ºä»€ä¹ˆè¦ Disposeï¼Ÿ</h4>

<p>å› ä¸ºæœ‰äº† <code class="highlighter-rouge">Subscriber</code> æ‰€ä»¥ <code class="highlighter-rouge">Observable</code> è¢«æ¿€æ´»ï¼Œç„¶åå†…éƒ¨å°±ä¼šä½¿ç”¨å„ç§å˜é‡æ¥ä¿å­˜èµ„æºï¼Œå¦‚æœä¸ <code class="highlighter-rouge">dispose</code> çš„è¯ï¼Œè¿™äº›èµ„æºå°±ä¼šä¸€ç›´è¢« keepï¼Œå¾ˆå®¹æ˜“é€ æˆå†…å­˜æ³„æ¼ã€‚</p>

<p>åŒæ—¶æ‰‹åŠ¨ dispose åˆå«Œéº»çƒ¦ï¼Œæ‰€ä»¥å°±æœ‰äº† <code class="highlighter-rouge">DisposeBag</code>ï¼Œå½“è¿™ä¸ª Bag è¢«å›æ”¶æ—¶ï¼ŒBag é‡Œé¢çš„ subscription ä¼šè‡ªåŠ¨è¢« disposeï¼Œç›¸å½“äºä» MRC å˜æˆäº† ARCã€‚</p>

<h3 id="å°ç»“">å°ç»“</h3>
<p>RxSwift å¦‚æœæ¦‚å¿µä¸Šæ•´ç†æ¸…æ¥šäº†ï¼Œä¼šå‘ç°å…¶å®å¹¶ä¸éš¾ï¼Œå¤šä» <code class="highlighter-rouge">Observable</code> çš„è§’åº¦å»æ€è€ƒé—®é¢˜ï¼Œå¤šæƒ³ç€è½¬æ¢å’Œç»„åˆï¼Œæ…¢æ…¢å°±ä¼šä»å‘½ä»¤å¼ç¼–ç¨‹è½¬åˆ°å£°æ˜å¼ç¼–ç¨‹ï¼Œå¯¹äºæŠ½è±¡èƒ½åŠ›å’Œä»£ç çš„å¯è¯»æ€§éƒ½ä¼šæœ‰æå‡ã€‚</p>


					<br />
					--EOF--
					<p>è‹¥æ— ç‰¹åˆ«è¯´æ˜ï¼Œæœ¬ç«™æ–‡ç« å‡ä¸ºåŸåˆ›ï¼Œè½¬è½½è¯·ä¿ç•™é“¾æ¥ï¼Œè°¢è°¢</p>
				</div>
				<div id="disqus_thread"></div>
				<script type="text/javascript">
				  /**
					* var disqus_identifier; [Optional but recommended: Define a unique identifier (e.g. post id or slug) for this thread]
					*/
				  (function() {
				   var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
				   dsq.src = 'http://lzyyblog.disqus.com/embed.js';
				   (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
				  })();
				</script>
				<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript=lzyyblog">comments powered by Disqus.</a></noscript>
			</div>
			<div id="footer">
	<p style="color:#ccc;font-size:12px;text-align: center">make the world a little better and easier</p>
	<p style="clear:both"></p>
</div>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-1281124-24', 'limboy.me');
  ga('send', 'pageview');

</script>

		</div>
	</body>
</html>
